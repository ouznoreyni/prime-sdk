**Documentation de l'API Marchand Distant**  

L‚Äô**API Marchand**  permet aux partenaires commerciaux d‚Äôint√©grer un syst√®me de paiement s√©curis√© directement dans leurs applications ou sites web. Con√ßue pour initier des transactions sur primes, elle offre une flexibilit√© optimale tout en assurant la s√©curit√© des donn√©es et la tra√ßabilit√© des op√©rations.


### **Pr√©requis**  
1. Compte marchand admin valid√© sur la plateforme.  
2. Acc√®s administrateur marchand pour g√©n√©rer les cl√©s API.  
3. Serveur HTTPS pour recevoir les callbacks.  

---

## **√âtapes d‚ÄôInt√©gration**  

### **√âtape 1 : G√©n√©ration des Cl√©s API**  
**Objectif** : Obtenir les identifiants n√©cessaires pour authentifier les requ√™tes. Ces identifiants sont envoy√©s √† l'adresse e-mail de l'administrateur du marchand lors de la g√©n√©ration des cl√©s API.

1. **Email format** :  
   ```
    "apiKey": "prime_api_key_550e8400...",  
    "apiSecret": "prime_api_secret_550e8400...",  
    "hmacKey": "aes256_encrypted_value"  
   ```  
3. **Actions** :  
   - Stockez `apiKey` et `apiSecret` bien s√©curis√©.  
   - La `hmacKey` sera utilis√©e pour v√©rifier les callbacks.  

---

### **√âtape 2 : Initialisation d‚Äôun Paiement**  
**Objectif** : D√©marrer une transaction et envoyer un lien de paiement au client.  

1. **Endpoint** :  
   ```bash  
   POST https://${base_url}/api/remote-merchant/payment-request
   ```  
2. **En-t√™tes Requis** :  
   ```http  
   X-API-KEY: "prime_api_key_550e8400..."  
   X-API-SECRET: "prime_api_secret_550e8400..."  
   Content-Type: application/json  
   ```  
3. **Corps de la Requ√™te** :  
   ```json  
   {  
     "callbackUrl": "https://votre-site.com/callback",  
     "amount": 5000,  // Montant en unit√©s (ex: 5000 XOF)  
     "phoneClient": "+221767760904",  
     "externalRefId": "CMD_20230920_123",  // Unique par transaction  
     "commandName": "Abonnement Premium"  
   }  
   ```  
4. **R√©ponse R√©ussie** :  
   ```json  
   {  
     "paymentId": "paymentId",  
     "deepLink": "deepLink",  
     "status": "PENDING"  
   }  
   ```  

---

### **√âtape 3 : Gestion des Callbacks**  
**Objectif** : Recevoir un callback lorsque votre client valide son premier paiement.

1. **Format du Callback** :  
   ```http  
   POST https://votre-site.com/callback  
   X-API-KEY: "prime_api_key_550e8400... API KEY"  
   X-HMAC-SIGNATURE: "signature_hmac:AES HASH MAC using statusPayment+primeClientMisdn+amount using raw application hmacKey"  
   ```  
   ```json  
   {  
     "callbackUrl": "https://votre-site.com/callback",  
     "amount": 5000,  
     "primeClientPhone": "+221767760904",  
     "externalRefId": "CMD_20230920_123",  
     "statusPayment": "SUCCESS",  
     "datePayment": "2023-09-20T14:30:00Z",  
     "primeInternalPaymentRef": "PAY_550e8400"  
   }  
   ```  

2. **Validation de la Signature HMAC** :  
   - Concat√©nez : `statusPayment + primeClientPhone + amount`.  
     ```javascript  
     const data = "SUCCESS+221761234567+5000";  
     ```  
   - G√©n√©rez le HMAC avec la `hmacKey` (d√©chiffr√©e) :  
     ```javascript  
     const hmac = crypto.createHmac('sha256', hmacKey).update(data).digest('hex');  
     ```  
   - Comparez avec `X-HMAC-SIGNATURE` pour authenticit√©.  

3. **Actions** :  
   - Mettez √† jour le statut de la commande dans votre syst√®me.  
   - Envoyez une confirmation au client (si r√©ussi).  

---

### **√âtape 5 : Surveillance**  
3. **Support** :  
   - Contactez `support@prime.store` en cas de probl√®me persistant.  

---

## **Bonnes Pratiques**  
- **Test en Sandbox** : Utilisez l‚Äôenvironnement de test avant le d√©ploiement en production.  
- **Validation des Entr√©es** : V√©rifiez toujours le format des num√©ros de t√©l√©phone et des URLs.  

---

## **Ressources Utiles**  
- **Utilisation** : Voir l'utilisation des SDK Java, Node.js, PHP.  
- **Support 24/7** : soon.  

**üí° Conseil** : Commencez avec des petits montants pour valider l‚Äôint√©gration avant de traiter des transactions critiques.